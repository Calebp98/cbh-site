---
import "../styles/global.css";
const currentYear = new Date().getFullYear();
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CBH</title>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/cbh-site/favicon-32x32.png"
    />
    <link rel="shortcut icon" href="/cbh-site/favicon-32x32.png" />
  </head>

  <body>
    <div class="container">
      <!-- Mailing List Banner -->
      <div class="mailing-banner">
        <a
          href="https://airtable.com/appaIHmOOcKdMRRwU/pagECavrg1fHWriWf/form"
          target="_blank"
          class="banner-link"
        >
          Join our mailing list →
        </a>
        <button class="banner-close" aria-label="Close banner">&times;</button>
      </div>

      <div class="mask-sketch"></div>
      <div class="far-uvc-sketch"></div>
      <div class="lab-robot-sketch"></div>
      <div class="pipette-sketch"></div>
      <div class="blood-cells-sketch"></div>
      <div class="chromosone-sketch"></div>
      <div class="crispr-sketch"></div>
      <div class="lab-coat-sketch"></div>
      <div class="sequencer-sketch"></div>
      <div class="test-tubes-sketch"></div>
      <header>
        <h1 id="title-text">Cambridge Biosecurity Hub</h1>
        <div class="typing-container">
          <span class="tagline-text"></span>
        </div>
      </header>

      <section>
        <p class="cbh-description">
          Cambridge Biosecurity Hub (CBH) is a team of researchers mitigating
          risks from emerging biotechnologies through field-building, research,
          and policy.
        </p>
      </section>

      <section>
        <h2>Current Projects</h2>
        <div class="projects-grid">
          <div class="project-card" data-color="coral-red">
            <div class="project-header">
              <h4>AIxBio Fellowship</h4>
              <button class="expand-btn" aria-label="Expand project details">
                <span class="expand-icon">+</span>
              </button>
            </div>
            <div class="project-content">
              <p>
                <strong
                  >CBH is collaborating with ERA to run the first AIxBio
                  Fellowship</strong
                >
              </p>
              <p>
                It is an 8-week, fully funded research fellowship at Cambridge,
                UK, from January 26 - March 20, 2026.
              </p>
              <p>
                Our aim is for fellows to work on concrete projects mitigating
                biosecurity risks, including those amplified by frontier AI.
              </p>
              <p>
                For more information visit <a href="https://aixbiosecurity.com"
                  >aixbiosecurity.com</a
                >
              </p>
              <p>
                <strong>Applications for fellows close November 5th</strong>
              </p>
            </div>
          </div>
        </div>

        <h3>Previous Projects:</h3>
        <div class="projects-grid">
          <div class="project-card" data-color="sage-green">
            <div class="project-header">
              <h4>Biosecurity Fundamentals Reading Groups</h4>
              <button class="expand-btn" aria-label="Expand project details">
                <span class="expand-icon">+</span>
              </button>
            </div>
            <div class="project-content">
              <p>
                In-person reading groups focused on fundamental biosecurity
                concepts and research.
              </p>
            </div>
          </div>

          <div class="project-card" data-color="burnt-orange">
            <div class="project-header">
              <h4>Biosecurity Research Sprints</h4>
              <button class="expand-btn" aria-label="Expand project details">
                <span class="expand-icon">+</span>
              </button>
            </div>
            <div class="project-content">
              <p>
                Intensive research sprints tackling specific biosecurity
                challenges and policy issues.
              </p>
            </div>
          </div>

          <div class="project-card" data-color="deep-purple">
            <div class="project-header">
              <h4>Cambridge Pandemic Prevention Symposium</h4>
              <button class="expand-btn" aria-label="Expand project details">
                <span class="expand-icon">+</span>
              </button>
            </div>
            <div class="project-content">
              <p>
                The Cambridge Pandemic Prevention Symposium was held at Jesus
                College on 7th October 2024. We had >100 attendees and a series
                of impressive speakers including Dr Cassidy Nelson (CLTR), Dr
                Ewan Harrison (University of Cambridge), Dr Nicole Wheeler
                (University of Birmingham) and Dr Sana Zakaria (RAND Europe).
              </p>
            </div>
          </div>
        </div>
      </section>

      <section>
        <h2>Meet the Team</h2>
        <div class="team">
          <div class="team-member">
            <h3>Dr Grace Braithwaite</h3>
            <img
              src="/cbh-site/profile_pics/grace.webp"
              alt="Grace Braithwaite"
              class="profile-image"
              data-bio="Grace is a medical doctor with a masters in public health. She now runs Cambridge Biosecurity Hub fulltime."
            />
            <p>Founder</p>
            <p class="bio-text">
              Grace is a medical doctor with a masters in public health. She now
              runs Cambridge Biosecurity Hub fulltime.
            </p>
          </div>
          <div class="team-member">
            <h3>Sandy Hickson</h3>
            <img
              src="/cbh-site/profile_pics/sandy.webp"
              alt="Sandy Hickson"
              class="profile-image"
              data-bio="Sandy is a PhD student in genetics and bioinformatics at the University of Cambridge."
            />
            <p>Founder</p>
            <p class="bio-text">
              Sandy is a PhD student in genetics and bioinformatics at the
              University of Cambridge.
            </p>
          </div>
          <div class="team-member">
            <h3>Dr Phil Palmer</h3>
            <img
              src="/cbh-site/profile_pics/phil.webp"
              alt="Phil Palmer"
              class="profile-image"
              data-bio="Phil has a PhD in bioinformatics from the University of Cambridge."
            />
            <p>Research Lead</p>
            <p class="bio-text">
              Phil has a PhD in bioinformatics from the University of Cambridge.
            </p>
          </div>
          <div class="team-member">
            <h3>Dr Richard Moulange</h3>
            <img
              src="/cbh-site/profile_pics/richard.webp"
              alt="Richard Moulange"
              class="profile-image"
              data-bio="Richard has a PhD in machine learning from the University of Cambridge, and works on AIxBio Policy at the Centre for Long-Term Resilience - a think tank based in London."
            />
            <p>Research Affiliate</p>
            <p class="bio-text">
              Richard has a PhD in machine learning from the University of
              Cambridge, and works on AIxBio Policy at the Centre for Long-Term
              Resilience - a think tank based in London.
            </p>
          </div>
        </div>
      </section>

      <footer>
        <p>
          CBH is a project of the community interest company registered as
          Meridian Impact CIC at Companies House (company number 13653958).
        </p>
        <p>
          © {currentYear}, Cambridge Biosecurity Hub / Meridian CIC. All rights
          reserved.
        </p>
        <p>
          <a
            href="https://docs.google.com/document/d/1CFYbwG6pk7IFZQGaJ_kjjFgLBL6DEOU-37cytMMzp8M/edit?tab=t.0"
            target="_blank">Code of Conduct</a
          > |
          <a
            href="https://airtable.com/apprENapaPZGahH6Q/pagJeUj3jByPSzIGu/form"
            target="_blank">Community Incident Form</a
          > |
          <a
            href="https://airtable.com/appaIHmOOcKdMRRwU/pagECavrg1fHWriWf/form"
            target="_blank">CBH Mailing List Signup</a
          > |
          <a
            href="https://www.linkedin.com/company/cambridge-biosecurity-hub/posts/?feedView=all"
            target="_blank">LinkedIn</a
          >
        </p>
        <div class="designer-credit">
          <p>
            Designed by <a href="https://calebp98.github.io/" target="_blank"
              >Caleb Parikh</a
            >
          </p>
        </div>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // DNA Transcription animation for tagline only
        const taglineText = document.querySelector(
          ".tagline-text"
        ) as HTMLElement;
        const taglines = [
          "Safeguarding Biological Research.",
          "Working to usher in a future of safe and transformative biotechnologies.",
        ];
        let taglineIndex = 0;
        const dnaBases = ["A", "C", "G", "T"];
        const rnaBases = ["A", "C", "G", "U"];

        let currentSequence: string[] = [];
        let animationIndex = 0;
        let titleAnimationSpeed = 250; // More movement - changes every 250ms (4 times per second)
        let pauseTime = 3000; // Pause before switching to next tagline

        function generateRandomSequence(
          targetText: string,
          bases: string[]
        ): string[] {
          return targetText.split("").map((char) => {
            if (char === " ") {
              return " "; // Keep spaces as spaces
            }
            return bases[Math.floor(Math.random() * bases.length)];
          });
        }

        function wrapBasesWithColors(sequence: string[]): string {
          return sequence
            .map((base) => {
              if (base === " ") {
                return " "; // Keep spaces as plain spaces
              }
              const className = `base-${base.toLowerCase()}`;
              return `<span class="${className}">${base}</span>`;
            })
            .join("");
        }

        function dnaTranscription() {
          const taglineMessage = taglines[taglineIndex];
          const targetChars = taglineMessage.split("");

          if (animationIndex === 0) {
            // Start with DNA sequence
            currentSequence = generateRandomSequence(taglineMessage, dnaBases);
            taglineText.innerHTML = wrapBasesWithColors(currentSequence);
          } else if (animationIndex === 1) {
            // Another DNA sequence variation
            currentSequence = generateRandomSequence(taglineMessage, dnaBases);
            taglineText.innerHTML = wrapBasesWithColors(currentSequence);
          } else if (animationIndex === 2) {
            // Convert to RNA
            currentSequence = currentSequence.map((base) =>
              base === "T" ? "U" : base
            );
            taglineText.innerHTML = wrapBasesWithColors(currentSequence);
          } else if (animationIndex === 3) {
            // Another RNA variation
            currentSequence = generateRandomSequence(taglineMessage, rnaBases);
            taglineText.innerHTML = wrapBasesWithColors(currentSequence);
          } else if (animationIndex === 4) {
            // Start introducing target characters
            const halfLength = Math.floor(targetChars.length / 2);
            for (let i = 0; i < halfLength; i++) {
              const randomIndex = Math.floor(
                Math.random() * currentSequence.length
              );
              currentSequence[randomIndex] = targetChars[randomIndex];
            }
            taglineText.innerHTML = wrapBasesWithColors(currentSequence);
          } else if (animationIndex === 5) {
            // Final result
            taglineText.textContent = taglineMessage;
            // Wait before switching to next tagline
            setTimeout(() => {
              animationIndex = 0;
              taglineIndex = (taglineIndex + 1) % taglines.length;
              dnaTranscription();
            }, pauseTime);
            return; // This message complete
          }

          animationIndex++;
          setTimeout(dnaTranscription, titleAnimationSpeed);
        }

        // Start DNA transcription animation for tagline
        dnaTranscription();

        // Project cards functionality
        const projectCards = document.querySelectorAll(".project-card");

        projectCards.forEach((card) => {
          card.addEventListener("click", function (event) {
            const target = event.target as HTMLElement;
            const content = card.querySelector(
              ".project-content"
            ) as HTMLElement;
            const icon = card.querySelector(".expand-icon") as HTMLElement;

            card.classList.toggle("expanded");

            if (card.classList.contains("expanded")) {
              icon.textContent = "−";
              content.style.maxHeight = content.scrollHeight + "px";
            } else {
              icon.textContent = "+";
              content.style.maxHeight = "0";
            }
          });
        });

        // Speech bubble functionality for team members
        const profileImages = document.querySelectorAll(".profile-image");
        let currentBubble: HTMLElement | null = null;

        function removeCurrentBubble() {
          if (currentBubble) {
            currentBubble.remove();
            currentBubble = null;
          }
        }

        function showBubble(img: HTMLImageElement) {
          // Remove any existing bubble
          removeCurrentBubble();

          const bio = img.getAttribute("data-bio");
          if (!bio) return;

          // Create new speech bubble
          const bubble = document.createElement("div");
          bubble.className = "speech-bubble";
          bubble.textContent = bio;

          // Add bubble to body for proper positioning
          document.body.appendChild(bubble);

          // Get image position
          const imgRect = img.getBoundingClientRect();

          // Position bubble
          positionBubble(bubble, imgRect);

          currentBubble = bubble;
        }

        function positionBubble(bubble: HTMLElement, imgRect: DOMRect) {
          const viewportWidth = window.innerWidth;
          const viewportHeight = window.innerHeight;
          const margin = 20;
          const isMobile = viewportWidth <= 768;

          // On mobile, use a simpler positioning approach
          if (isMobile) {
            bubble.classList.remove("tail-right", "tail-left");
            bubble.classList.add("tail-bottom");

            // Position above the image initially
            let topPosition = imgRect.top - 200; // Use estimated height
            let leftPosition = imgRect.left + imgRect.width / 2 - 125; // Center with estimated width

            // Ensure bubble stays within viewport horizontally
            if (leftPosition < margin) {
              leftPosition = margin;
            } else if (leftPosition + 250 > viewportWidth - margin) {
              leftPosition = viewportWidth - 250 - margin;
            }

            bubble.style.left = `${leftPosition}px`;
            bubble.style.top = `${topPosition}px`;

            // Now get actual dimensions and adjust if needed
            setTimeout(() => {
              const bubbleRect = bubble.getBoundingClientRect();
              const bubbleWidth = bubbleRect.width;
              const bubbleHeight = bubbleRect.height;

              // Only adjust if we got valid dimensions
              if (bubbleWidth > 0 && bubbleHeight > 0) {
                // Recalculate position with actual dimensions
                let finalTopPosition = imgRect.top - bubbleHeight - 15;

                // If not enough space above, position below
                if (finalTopPosition < margin) {
                  finalTopPosition = imgRect.bottom + 15;
                  bubble.classList.remove("tail-bottom");
                  bubble.classList.add("tail-top");
                }

                let finalLeftPosition =
                  imgRect.left + imgRect.width / 2 - bubbleWidth / 2;

                // Ensure bubble stays within viewport
                if (finalLeftPosition < margin) {
                  finalLeftPosition = margin;
                } else if (
                  finalLeftPosition + bubbleWidth >
                  viewportWidth - margin
                ) {
                  finalLeftPosition = viewportWidth - bubbleWidth - margin;
                }

                bubble.style.left = `${finalLeftPosition}px`;
                bubble.style.top = `${finalTopPosition}px`;
              }
            }, 50);

            return;
          }

          // Desktop positioning logic
          const bubbleRect = bubble.getBoundingClientRect();
          const bubbleWidth = bubbleRect.width;
          const bubbleHeight = bubbleRect.height;

          const spaceOnRight = viewportWidth - imgRect.right;
          const showOnRight = spaceOnRight >= bubbleWidth + margin;

          // Position horizontally
          if (showOnRight) {
            bubble.classList.add("tail-right");
            bubble.classList.remove("tail-left");
            bubble.style.left = `${imgRect.right + 10}px`;
          } else {
            bubble.classList.add("tail-left");
            bubble.classList.remove("tail-right");
            bubble.style.left = `${Math.max(margin, imgRect.left - bubbleWidth - 10)}px`;
          }

          // Position vertically - center relative to image, but keep within viewport
          let topPosition = imgRect.top + imgRect.height / 2 - bubbleHeight / 2;

          // Ensure bubble doesn't go above viewport
          if (topPosition < margin) {
            topPosition = margin;
          }

          // Ensure bubble doesn't go below viewport
          if (topPosition + bubbleHeight > viewportHeight - margin) {
            topPosition = viewportHeight - bubbleHeight - margin;
          }

          bubble.style.top = `${topPosition}px`;
        }

        profileImages.forEach((image) => {
          const img = image as HTMLImageElement;
          const bio = img.getAttribute("data-bio");

          if (!bio) return;

          // Check if device is mobile
          const isMobile = window.innerWidth <= 768;

          // Only add speech bubble events on desktop
          if (!isMobile) {
            // Desktop hover events
            img.addEventListener("mouseenter", function () {
              showBubble(img);
            });

            img.addEventListener("mouseleave", function () {
              removeCurrentBubble();
            });

            // Click event for desktop
            img.addEventListener("click", function (e) {
              showBubble(img);
            });
          }

          // Remove bubble on scroll or resize
          img.addEventListener("scroll", removeCurrentBubble);
        });

        // Remove bubble on window resize or scroll
        window.addEventListener("resize", removeCurrentBubble);
        window.addEventListener("scroll", removeCurrentBubble);

        // Mailing banner close functionality
        const bannerClose = document.querySelector(
          ".banner-close"
        ) as HTMLElement;
        const mailingBanner = document.querySelector(
          ".mailing-banner"
        ) as HTMLElement;

        if (bannerClose && mailingBanner) {
          bannerClose.addEventListener("click", function () {
            mailingBanner.classList.add("hidden");
          });
        }
      });
    </script>
  </body>
</html>
